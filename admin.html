<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- Firebase Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Ù…ØªÙˆØ§ÙÙ‚Ø© (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¬Ù†Ø§Ù† Ø¨ÙŠØ²Ù†Ø³</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" href="./assets/img/logo.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #4a90e2;
      --danger: #e74c3c;
      --success: #2ecc71;
      --warning: #f39c12;
      --bg: #f8f9fa;
      --surface: #ffffff;
      --text: #2c3e50;
      --muted: #6c757d;
      --border: #dee2e6;
    }

    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: var(--text);
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    
    .admin-header {
      background: var(--surface);
      border-bottom: 2px solid var(--primary);
      padding: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .admin-header .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-title {
      font-size: 1.8rem;
      color: var(--primary);
    }
    
    .logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    .tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--border);
      overflow-x: auto;
      flex-wrap: nowrap;
    }
    
    .tab-btn {
      background: none;
      border: none;
      padding: 12px 24px;
      font-family: 'Cairo', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      position: relative;
      bottom: -2px;
      white-space: nowrap;
    }
    
    .tab-btn:hover {
      color: var(--primary);
    }
    
    .tab-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--surface);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border-right: 4px solid var(--primary);
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }
    
    .data-table {
      background: var(--surface);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .table-header {
      background: var(--primary);
      color: white;
      padding: 20px;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .table-content {
      padding: 20px;
    }
    
    .inquiry-item {
      background: var(--bg);
      padding: 20px;
      margin-bottom: 16px;
      border-radius: 8px;
      border-right: 4px solid var(--primary);
      transition: all 0.3s ease;
    }
    
    .inquiry-item:hover {
      transform: translateX(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .inquiry-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .inquiry-name {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--text);
    }
    
    .inquiry-service {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .inquiry-details {
      color: var(--text);
      line-height: 1.7;
      margin-bottom: 12px;
    }
    
    .inquiry-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    
    .inquiry-date {
      color: var(--muted);
      font-size: 0.85rem;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-decoration: none;
      display: inline-block;
    }
    
    .btn-delete {
      background: var(--danger);
      color: white;
    }
    
    .btn-delete:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .empty-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--primary);
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: var(--surface);
      padding: 32px;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }
    
    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: var(--text);
    }
    
    .modal-text {
      color: var(--muted);
      margin-bottom: 24px;
      line-height: 1.7;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .btn-cancel {
      background: var(--muted);
      color: white;
    }
    
    .btn-cancel:hover {
      background: #5a6268;
    }
    
    .btn-confirm {
      background: var(--danger);
      color: white;
    }
    
    .btn-confirm:hover {
      background: #c0392b;
    }
    
    @media (max-width: 768px) {
      .admin-title {
        font-size: 1.3rem;
      }
      
      .tab-btn {
        font-size: 1rem;
        padding: 10px 16px;
      }
      
      .inquiry-header {
        flex-direction: column;
        gap: 8px;
      }
      
      .inquiry-footer {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- Login Modal -->
  <div id="loginModal" class="modal active" style="z-index:2000;">
    <div class="modal-content" style="max-width:350px;">
      <h2 class="modal-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
      <form id="loginForm" autocomplete="off" onsubmit="return false;">
        <div style="margin-bottom:16px; text-align:right;">
          <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <input id="username" name="username" type="text" style="width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;direction:ltr;" required autocomplete="username">
        </div>
        <div style="margin-bottom:20px; text-align:right;">
          <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input id="password" name="password" type="password" style="width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #ccc;direction:ltr;" required autocomplete="current-password">
        </div>
        <div id="loginError" style="color:#e74c3c;min-height:22px;margin-bottom:12px;font-size:0.95rem;"></div>
        <button type="submit" class="btn btn-confirm" style="width:100%;font-size:1.1rem;">Ø¯Ø®ÙˆÙ„</button>
      </form>
    </div>
  </div>

  <!-- Header -->
  <header class="admin-header">
    <div class="container">
      <h1 class="admin-title">ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      <button class="logout-btn" id="logoutBtn" style="display:none;" onclick="logoutPanel()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      <button class="logout-btn" onclick="window.location.href='./index.html'">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="all">Ø§Ù„ÙƒÙ„ (<span id="allCount">0</span>)</button>
      <button class="tab-btn" data-tab="contact">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ (<span id="contactCount">0</span>)</button>
      <button class="tab-btn" data-tab="feasibility">Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰ (<span id="feasibilityCount">0</span>)</button>
      <button class="tab-btn" data-tab="finance">Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© (<span id="financeCount">0</span>)</button>
      <button class="tab-btn" data-tab="marketing">ØªØ³ÙˆÙŠÙ‚ÙŠØ© (<span id="marketingCount">0</span>)</button>
      <button class="tab-btn" data-tab="tech-services">ØªÙ‚Ù†ÙŠØ© (<span id="techCount">0</span>)</button>
      <button class="tab-btn" data-tab="business-services">Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ† (<span id="businessCount">0</span>)</button>
      <button class="tab-btn" data-tab="creative-services">Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© (<span id="creativeCount">0</span>)</button>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
        <div class="stat-number" id="inquiriesCount">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
        <div class="stat-number" id="todayCount">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
        <div class="stat-number" id="weekCount">0</div>
      </div>
    </div>

    <!-- Inquiries -->
    <div class="data-table">
      <div class="table-header">
        <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;justify-content:space-between;">
          <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
          <div style="display:flex;gap:10px;align-items:center;">
            <label for="serviceFilter" style="font-size:0.95rem;">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:</label>
            <select id="serviceFilter" style="padding:6px 12px;border-radius:6px;">
              <option value="all">Ø§Ù„ÙƒÙ„</option>
              <option value="contact">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</option>
              <option value="feasibility">Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰</option>
              <option value="finance">Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©</option>
              <option value="marketing">ØªØ³ÙˆÙŠÙ‚ÙŠØ©</option>
              <option value="tech-services">ØªÙ‚Ù†ÙŠØ©</option>
              <option value="business-services">Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†</option>
              <option value="creative-services">Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</option>
            </select>
            <button id="sortDateBtn" class="btn" style="background:var(--primary);color:#fff;">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</button>
          </div>
          <a href="./reviews.html" class="btn" style="background:white; color:var(--primary); padding:8px 16px; font-size:0.9rem;">
            ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
          </a>
        </div>
      </div>
      <div class="table-content" id="inquiries-list">
        <div class="loading">
          <div class="spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
      <p class="modal-text">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.</p>
      <div class="modal-actions">
        <button class="btn btn-cancel" onclick="closeDeleteModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn btn-confirm" onclick="confirmDelete()">Ø­Ø°Ù</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script>
    // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:
    // Ø§Ù„Ø£Ø¯Ù…Ù†: jenanbiz.sa / Jenan2030@
    // Ø§Ù„Ø¹Ø§Ø¯ÙŠ: 101 / 102938sa
    const USERS = [
      { username: 'jenanbiz.sa', password: 'Jenan2030@', role: 'admin' },
      { username: '101', password: '102938sa', role: 'user' }
    ];

    function showLoginModal() {
      document.getElementById('loginModal').classList.add('active');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginError').textContent = '';
      document.body.style.overflow = 'hidden';
    }
    function hideLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
      document.body.style.overflow = '';
    }
    function loginPanel() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const user = USERS.find(u => u.username === username && u.password === password);
      if (user) {
        localStorage.setItem('panelRole', user.role);
        hideLoginModal();
        document.getElementById('logoutBtn').style.display = '';
        showDeleteButtons();
      } else {
        document.getElementById('loginError').textContent = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      }
    }
    function logoutPanel() {
      localStorage.removeItem('panelRole');
      showLoginModal();
      document.getElementById('logoutBtn').style.display = 'none';
      showDeleteButtons();
    }
    window.logoutPanel = logoutPanel;

    window.addEventListener('DOMContentLoaded', () => {
      const role = localStorage.getItem('panelRole');
      if (!role) {
        showLoginModal();
        document.getElementById('logoutBtn').style.display = 'none';
      } else {
        hideLoginModal();
        document.getElementById('logoutBtn').style.display = '';
      }
      showDeleteButtons();

      // ØªÙØ¹ÙŠÙ„ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.onsubmit = function(e) {
          e.preventDefault();
          loginPanel();
          return false;
        };
      }
    });
    function showDeleteButtons() {
      const role = localStorage.getItem('panelRole');
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.style.display = (role === 'admin') ? '' : 'none';
      });
    }

    // --- Firebase ---
    if (!window._fbApp) {
      window._fbApp = firebase.initializeApp({
        apiKey: "AIzaSyBXhgIv3LbjcPwPYZ3u0tw7ZNSqox8pSmI",
        authDomain: "jenan-star.firebaseapp.com",
        projectId: "jenan-star",
        storageBucket: "jenan-star.firebasestorage.app",
        messagingSenderId: "506906396662",
        appId: "1:506906396662:web:57b4ed3b38ab2c0086c68f"
      });
    }
    var db = firebase.firestore();
    // --- Ù…ØªØºÙŠØ±Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© ---
    let deleteTarget = null;
    let currentTab = 'all';
      let currentSortDesc = true;
    let allInquiries = [];

    // Ù…ØªØºÙŠØ± Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø­Ø¯Ø« Ø·Ù„Ø¨

    // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
    const serviceNames = {
      'contact': 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§',
      'feasibility': 'Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰',
      'finance': 'Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©',
      'marketing': 'ØªØ³ÙˆÙŠÙ‚ÙŠØ©',
      'tech-services': 'ØªÙ‚Ù†ÙŠØ©',
      'business-services': 'Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†',
      'creative-services': 'Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©'
    };

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Firestore
    async function loadInquiries() {
      const inquiriesList = document.getElementById('inquiries-list');
      inquiriesList.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p></div>';
      try {
        const snapshot = await db.collection('inquiries').get();
        if (snapshot.empty) {
          inquiriesList.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p></div>';
          document.getElementById('inquiriesCount').textContent = '0';
          document.getElementById('todayCount').textContent = '0';
          document.getElementById('weekCount').textContent = '0';
          document.getElementById('allCount').textContent = '0';
          document.getElementById('contactCount').textContent = '0';
          document.getElementById('feasibilityCount').textContent = '0';
          document.getElementById('financeCount').textContent = '0';
          document.getElementById('marketingCount').textContent = '0';
          document.getElementById('techCount').textContent = '0';
          document.getElementById('businessCount').textContent = '0';
          document.getElementById('creativeCount').textContent = '0';
          return;
        }
        allInquiries = [];
        snapshot.forEach(doc => {
          allInquiries.push({ id: doc.id, ...doc.data() });
        });
        // Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
        allInquiries.sort((a, b) => {
          const dateA = a.createdAt?.seconds || 0;
          const dateB = b.createdAt?.seconds || 0;
          return dateB - dateA;
        });
        updateCounts();
        filterInquiries();
      } catch (error) {
        console.error('Firestore load error:', error);
        inquiriesList.innerHTML = `<div class='empty-state'><div class='empty-icon'>âš ï¸</div><p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p><p style='color:var(--danger);font-size:0.9rem;margin-top:8px;'>${error.message}</p></div>`;
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­
        let errBox = document.createElement('div');
        errBox.style = 'background:#fff0f0;color:#c0392b;padding:12px 18px;margin:18px 0;border-radius:8px;font-size:1.1em;direction:ltr;word-break:break-all;';
        errBox.textContent = error.stack || error.message || error;
        inquiriesList.appendChild(errBox);
      }
    }

    function updateCounts() {
      document.getElementById('allCount').textContent = allInquiries.length;
      document.getElementById('contactCount').textContent = allInquiries.filter(i => i.service === 'contact').length;
      document.getElementById('feasibilityCount').textContent = allInquiries.filter(i => i.service === 'feasibility').length;
      document.getElementById('financeCount').textContent = allInquiries.filter(i => i.service === 'finance').length;
      document.getElementById('marketingCount').textContent = allInquiries.filter(i => i.service === 'marketing').length;
      document.getElementById('techCount').textContent = allInquiries.filter(i => i.service === 'tech-services').length;
      document.getElementById('businessCount').textContent = allInquiries.filter(i => i.service === 'business-services').length;
      document.getElementById('creativeCount').textContent = allInquiries.filter(i => i.service === 'creative-services').length;
      // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø£Ø³Ø¨ÙˆØ¹
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayCount = allInquiries.filter(inq => {
        if (!inq.createdAt?.seconds) return false;
        const inqDate = new Date(inq.createdAt.seconds * 1000);
        inqDate.setHours(0, 0, 0, 0);
        return inqDate.getTime() === today.getTime();
      }).length;
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekCount = allInquiries.filter(inq => {
        if (!inq.createdAt?.seconds) return false;
        const inqDate = new Date(inq.createdAt.seconds * 1000);
        return inqDate >= weekAgo;
      }).length;
      document.getElementById('todayCount').textContent = todayCount;
      document.getElementById('weekCount').textContent = weekCount;
    }

    function filterInquiries() {
      // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      let filterVal = document.getElementById('serviceFilter')?.value || currentTab;
      let filtered = filterVal === 'all' ? allInquiries : allInquiries.filter(inq => inq.service === filterVal);
      // ÙØ±Ø² Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
      filtered = filtered.slice().sort((a, b) => {
        if (!a.createdAt?.seconds || !b.createdAt?.seconds) return 0;
        return currentSortDesc ? b.createdAt.seconds - a.createdAt.seconds : a.createdAt.seconds - b.createdAt.seconds;
      });
      const inquiriesList = document.getElementById('inquiries-list');
      if (filtered.length === 0) {
        inquiriesList.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p></div>';
        return;
      }
      let html = '';
      // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„ÙƒÙ„ Ø­Ù‚Ù„
      const fieldLabels = {
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
        fullName: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
        name: 'Ø§Ù„Ø§Ø³Ù…',
        contactName: 'Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨',
        mobile: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„',
        contactPhone: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„',
        phone: 'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„',
        contactEmail: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹/Ø§Ù„Ù…Ù†Ø´Ø£Ø©
        mainType: 'Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·',
        entityAge: 'Ø¹Ù…Ø± Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª)',
        hq: 'Ù…Ù‚Ø± Ø§Ù„Ø´Ø±ÙƒØ©',
        entityType: 'Ù†ÙˆØ¹ Ø§Ù„ÙƒÙŠØ§Ù†',
        ownership: 'Ù…Ù„ÙƒÙŠØ© Ø§Ù„Ø´Ø±ÙƒØ©',
        hasStatements: 'Ù‡Ù„ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ø¦Ù… Ù…Ø§Ù„ÙŠØ© Ø¢Ø®Ø± Ø³Ù†ØªÙŠÙ†ØŸ',
        revenues: 'ÙƒÙ… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§ØªØŸ (Ø±ÙŠØ§Ù„)',
        profit: 'ÙƒÙ… Ø§Ù„Ø±Ø¨Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø²ÙƒØ§Ø©ØŸ (Ø±ÙŠØ§Ù„)',
        hasContracts: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¹Ù‚ÙˆØ¯ Ù„Ù„Ù…Ù†Ø´Ø£Ø© Ù…Ø¹ Ø§Ù„ØºÙŠØ±ØŸ',
        deposits: 'ÙƒÙ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø¢Ø®Ø± 12 Ø´Ù‡Ø±ØŸ (Ø±ÙŠØ§Ù„)',
        hasCommitments: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŸ',
        commitmentAmount: 'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ (Ø±ÙŠØ§Ù„)',
        commitmentLeft: 'ÙƒÙ… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ (Ø±ÙŠØ§Ù„)',
        activityDesc: 'ÙˆØµÙ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ',
        studyType: 'Ù†ÙˆØ¹ Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ‰',
        activity: 'Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        city: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
        projectDescription: 'ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        details: 'ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©',
        services: 'Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
        // Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        projectName: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        projectDetails: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
        budget: 'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©',
        businessName: 'Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø§Ø±ÙŠ',
        companyName: 'Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©',
        additionalInfo: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©',
        currentStatus: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ',
        website: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        // Ø£ÙŠ Ø­Ù‚Ù„ Ø¢Ø®Ø± ÙŠØ¶Ø§Ù Ù‡Ù†Ø§
      };
      filtered.forEach((inquiry) => {
        const date = inquiry.createdAt?.seconds 
          ? new Date(inquiry.createdAt.seconds * 1000).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })
          : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const serviceName = inquiry.serviceName || serviceNames[inquiry.service] || inquiry.service || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ù…ÙƒÙ†Ø©
        const nameVal = inquiry.name || inquiry.fullName || inquiry.contactName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const phoneVal = inquiry.phone || inquiry.mobile || inquiry.contactPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const emailVal = inquiry.email || inquiry.contactEmail || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„
        const arabicValue = (val, key) => {
          if (!val || val === 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' || val === 'undefined' || val === 'null') return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          // ØªØ±Ø¬Ù…Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
          if (typeof val === 'string') {
            if (val.toLowerCase() === 'male') return 'Ø°ÙƒØ±';
            if (val.toLowerCase() === 'female') return 'Ø£Ù†Ø«Ù‰';
            if (val === 'yes' || val === 'Ù†Ø¹Ù…') return 'Ù†Ø¹Ù…';
            if (val === 'no' || val === 'Ù„Ø§') return 'Ù„Ø§';
            if (val === 'undefined' || val === 'null') return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          }
          // ØªØ±Ø¬Ù…Ø© true/false
          if (val === true) return 'Ù†Ø¹Ù…';
          if (val === false) return 'Ù„Ø§';
          return val;
        };

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©
        let stepOrder = [
          'fullName','name','contactName','mobile','phone','contactPhone','contactEmail','email','mainType','entityAge','hq','entityType','ownership','hasStatements','revenues','profit','hasContracts','deposits','hasCommitments','commitmentAmount','commitmentLeft','activityDesc','studyType','activity','city','projectDescription','details','services'
        ];
        if (inquiry.service === 'feasibility') {
          stepOrder = ['studyType','activity','city','contactName','contactPhone','contactEmail','projectDescription','details','services'];
        }
        let fieldsHtml = '';
        // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨
        stepOrder.forEach(key => {
          if (inquiry[key]) {
            if (Array.isArray(inquiry[key])) {
              fieldsHtml += `<div><strong>${fieldLabels[key] || key}:</strong> ${inquiry[key].map(v => arabicValue(v, key)).join('ØŒ ')}</div>`;
            } else {
              fieldsHtml += `<div><strong>${fieldLabels[key] || key}:</strong> ${arabicValue(inquiry[key], key)}</div>`;
            }
          }
        });
        // Ø¹Ø±Ø¶ Ø£ÙŠ Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ© ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±Ø© ÙÙŠ stepOrder
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ØªÙŠ Ù„Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§
        const hiddenFields = [
          'id','createdAt','service','serviceName','files','form','subject_','gotcha_','clientName','_gotcha','_subject','_form','_template','_next','_captcha','_cc','_replyto','_autoresponse','_webhook','_redirect','_confirmation','_token','_action','_method','_language','_charset','_encoding','_submit','_id','_v','_type','_user','_date','_time','_ip','_browser','_os','_device','_referrer','_ga','_gid','_fbp','_fbc','_gcl','_utm','_gl','_gaid','_fbclid','_openstat','_ym_uid','_ym_counter','_ym_isad','_ym_debug','_ym_host','_ym_referrer','_ym_visor','_ym_cid','_ym_ab','_ym_uid','_ym_counter','_ym_isad','_ym_debug','_ym_host','_ym_referrer','_ym_visor','_ym_cid','_ym_ab'
        ];
        Object.keys(inquiry).forEach(key => {
          if (!stepOrder.includes(key) && !hiddenFields.includes(key)) {
            if (Array.isArray(inquiry[key])) {
              fieldsHtml += `<div><strong>${fieldLabels[key] || key}:</strong> ${inquiry[key].map(v => arabicValue(v, key)).join('ØŒ ')}</div>`;
            } else {
              fieldsHtml += `<div><strong>${fieldLabels[key] || key}:</strong> ${arabicValue(inquiry[key], key)}</div>`;
            }
          }
        });
        let filesHtml = '';
        if (Array.isArray(inquiry.files) && inquiry.files.length > 0) {
          filesHtml = '<div style="margin:10px 0 0 0; padding:10px; background:#f8f9fa; border-radius:8px;">' +
            '<strong>ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©:</strong><ul style="margin:8px 0 0 0; padding:0 0 0 18px;">' +
            inquiry.files.map(f => `<li><a href="${f.url}" target="_blank" style="color:var(--primary);">${f.name}</a></li>`).join('') +
            '</ul></div>';
        }
        html += `
          <div class="inquiry-item">
            <div class="inquiry-header">
              <div>
                <div class="inquiry-name">ğŸ‘¤ ${arabicValue(nameVal, 'name')}</div>
                <div class="inquiry-service" style="margin-top:8px;">
                  <strong>ğŸ“‹ Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${arabicValue(serviceName, 'serviceName')}
                  ${phoneVal && phoneVal !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' ? `<br><strong>ğŸ“</strong> ${arabicValue(phoneVal, 'phone')}` : ''}
                  ${emailVal && emailVal !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' ? `<br><strong>ğŸ“§</strong> ${arabicValue(emailVal, 'email')}` : ''}
                </div>
              </div>
            </div>
            <div style="margin:12px 0; padding:12px; background:rgba(74,144,226,0.05); border-radius:8px;">
              ${fieldsHtml}
            </div>
            ${filesHtml}
            <div class="inquiry-footer">
              <div class="inquiry-date">ğŸ• ${date}</div>
              <button class="btn btn-delete" onclick="deleteInquiry('${inquiry.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      });
      inquiriesList.innerHTML = html;
      showDeleteButtons();
    }

    // Ø­Ø°Ù Ø·Ù„Ø¨
    window.deleteInquiry = function(inquiryId) {
      deleteTarget = { type: 'inquiry', id: inquiryId };
      document.getElementById('deleteModal').classList.add('active');
    };
    window.closeDeleteModal = function() {
      document.getElementById('deleteModal').classList.remove('active');
      deleteTarget = null;
    };
    window.confirmDelete = async function() {
      if (!deleteTarget) return;
      try {
        await db.collection('inquiries').doc(deleteTarget.id).delete();
        closeDeleteModal();
        loadInquiries();
      } catch (error) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
      }
    };

    // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentTab = this.getAttribute('data-tab');
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ÙŠØ¶Ø§Ù‹
        const filterSel = document.getElementById('serviceFilter');
        if (filterSel) filterSel.value = currentTab;
        filterInquiries();
      });
    });

    // ØªØµÙÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    document.getElementById('serviceFilter').addEventListener('change', function(){
      currentTab = this.value;
      filterInquiries();
    });

    // Ø²Ø± ÙØ±Ø² Ø§Ù„ØªØ§Ø±ÙŠØ®
    document.getElementById('sortDateBtn').addEventListener('click', function(){
      currentSortDesc = !currentSortDesc;
      this.textContent = currentSortDesc ? 'Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹' : 'Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹';
      filterInquiries();
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
    loadInquiries();
  </script>
</body>
</html>
